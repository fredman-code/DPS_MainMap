import { adjustClassToCorridor } from "./utils";
export const maps = [
    {
      name: "Primary GF",
      image: require("../assets/PrimaryGF.jpg"),
      originalWidth: 2481,
      originalHeight: 1790,
      corridors: [
        { id: 1, coords: [237,910,271,1723], rooms: [53,54,55,56,57,58,59,60,61,62,63,64,77,76] },
        { id: 2, coords: [202,996,664,1025], rooms: [] },
        { id: 3, coords: [204,1605,659,1637], rooms: [] },
        { id: 4, coords: [631,969,665,1652], rooms: [65,66,67,68,70,71,72,73,74,75] },
        { id: 5, coords: [931,1297,1580,1334], rooms: [4,3,2,1,5,6,7,8,9,11] },
        { id: 6, coords: [670,1186,854,1223], rooms: [78] },
        { id: 7, coords: [920,1284,851,1183], rooms: [69] },
        { id: 8, coords: [670,1408,806,1456], rooms: [80] },
        { id: 9, coords: [904,1369,798,1448], rooms: [79,81] },
        { id: 10, coords: [2241,141,2271,840], rooms: [14,13,15,16,17,18,19,20,24,21,33,35] },
        { id: 11, coords: [2274,1718,2242,906], rooms: [36,22,23,24,25,26,27,28,29,30,31,32,48,47] },
        { id: 12, coords: [2308,994,1846,1024], rooms: [] },
        { id: 13, coords: [2300,1636,1838,1604], rooms: [] },
        { id: 14, coords: [1847,957,1882,1654], rooms: [38,37,39,41,42,49,43,44,45,46] },
        { id: 15, coords: [1848,1223,1675,1183], rooms: [50] },
        { id: 16, coords: [1842,1443,1680,1405], rooms: [51] },
        { id: 17, coords: [1675,1190,1590,1283], rooms: [40,10] },
        { id: 18, coords: [1675,1452,1590,1337], rooms: [52] }
    ],
    points: [
        [1151,1397],[1088,1392],[957,1377],[968,1244],[1149,1204],[1226,1197],[1269,1205],[1347,1202],[1407,1380],[1562,1245],[1553,1371],[2314,344],
        [2316,225],[2198,178],[2198,258],[2198,318],[2198,411],[2198,491],[2306,484],[2198,570],[2191,652],[2318,943],[2185,1074],[2191,1163],[2313,1168],
        [2191,1258],[2324,1255],[2195,1356],[2329,1349],[2191,1457],[2331,1451],[2193,1544],[2186,770],[2331,580],[2301,813],[2185,950],[1786,953],[1930,945],
        [1791,1036],[1618,1191],[1937,1188],[1935,1279],[1932,1465],[1784,1597],[1796,1693],[1935,1690],[2181,1665],[2331,1660],[1927,1379],[1774,1141],[1798,1482],
        [1608,1444],[177,947],[315,939],[307,1092],[186,1165],[304,1173],[191,1256],[315,1268],[189,1372],[319,1364],[187,1444],[307,1452],[312,1559],
        [569,952],[717,932],[719,1045],[568,1163],[917,1173],[564,1256],[571,1344],[563,1462],[716,1577],[716,1681],[563,1673],[324,1686],[177,1683],[709,1138],[840,1472],
        [699,1477],[915,1442]
  
      ],
      stairs: [
        [201,1013],[204,1615],[644,979],[643,1647],[1041,1268],[1454,1271],[1864,975],[1852,1645],[2299,1622],[2299,1012],[2299,307],[2303,666]
      ]
    },
    {
      name: "Primary FF",
      image: require("../assets/PrimaryFF.jpg"),
      originalWidth: 2481,
      originalHeight: 1741,
      corridors: [
        { id: 1, coords: [205,865,229,1696], rooms: [49,56,57,62,63,58,59,64,65,60,61,50] },
        { id: 2, coords: [622,960,170,989], rooms: [55,47,45] },
        { id: 3, coords: [165,1580,628,1609], rooms: [48,46] },
        { id: 4, coords: [593,941,622,1635], rooms: [42,41,54,53,52,51,43,44] },
        { id: 5, coords: [787,1147,628,1187], rooms: [40] },
        { id: 6, coords: [880,1256,763,1155], rooms: [37] },
        { id: 7, coords: [628,1370,808,1426], rooms: [39] },
        { id: 8, coords: [883,1308,776,1425], rooms: [38] },
        { id: 9, coords: [851,1256,1590,1309], rooms: [36,35,33,34,32,31,29] },
        { id: 10, coords: [2199,91,2236,867], rooms: [16,15,18,17,19,20,71,70,72,69,68,23,67,66,22] },
        { id: 11, coords: [2231,1702,2202,878], rooms: [13,14,12,11,10,9,8,7,6,5,4,3,2,1] },
        { id: 12, coords: [2266,1575,1801,1610], rooms: [24,73] },
        { id: 13, coords: [2266,960,1806,1000], rooms: [25,81] },
        { id: 14, coords: [1808,936,1848,1630], rooms: [80,79,78,77,76,75,74,82] },
        { id: 15, coords: [1806,1151,1614,1196], rooms: [27] },
        { id: 16, coords: [1798,1419,1614,1371], rooms: [26] },
        { id: 17, coords: [1548,1310,1651,1417], rooms: [30] },
        { id: 18, coords: [1542,1260,1643,1154], rooms: [28] }
    ],
    points: [
        [2140,1666],[2296,1661],[2140,1533],[2291,1434],[2143,1437],[2288,1329],[2151,1326],[2293,1238],[2142,1235],[2289,1150],[2145,1142],[2138,1037],[2293,907],[2138,911],
        [2293,796],[2133,799],[2288,710],[2138,723],[2143,650],[2143,574],[2296,496],[2273,110],[2273,296],[2030,1656],[2030,922],[1758,1452],[1739,1120],[1560,1161],[1493,1216],
        [1580,1419],[1492,1341],[1379,1347],[1055,1339],[1211,1226],[942,1347],[922,1233],[834,1138],[854,1432],[658,1459],[671,1093],[666,1017],[661,922],[673,1550],[661,1635],
        [536,929],[506,1651],[430,924],[275,1655],[154,919],[142,1653],[536,1419],[530,1319],[541,1215],[541,1125],[305,922],[277,1055],[277,1158],[290,1261],[289,1347],[292,1454],
        [285,1537],[154,1125],[146,1231],[144,1324],[142,1421],[2148,137],[2148,203],[2153,277],[2148,343],[2148,428],[2151,496],[2274,421],[1891,1660],[1751,1560],[1884,1435],
        [1901,1333],[1891,1241],[1886,1142],[1764,1022],[1756,917],[1906,926],[1756,1655]
      ],
      stairs: [
        [175,975],[172,1604],[594,934],[602,1619],[994,1234],[1410,1244],[1813,929],[1818,1623],[2245,1593],[2240,969],[2251,260],[2248,596]
      ]
    },
    {
      name: "Senior FF",
      image: require("../assets/SeniorFF.jpg"),
      originalWidth: 2481,
      originalHeight: 1754,
      corridors: [
        { id: 1, coords: [1106,572,2255,616], rooms: [6,7,5,9,8,10,11,12,13,14,15,16,17,18,19,23,20,21,22,51] },
        { id: 2, coords: [2199,490,2231,1638], rooms: [25,24,27,28,29,30,31,32,33,34,35,36,37,38,39,40] },
        { id: 3, coords: [1024,1632,987,714], rooms: [72,73,71,70,68,69,66,67,65,64,63,62,60,61,51] },
        { id: 4, coords: [433,957,1034,991], rooms: [59,58,57,56,55,54,53,52] },
        { id: 5, coords: [215,1415,247,1623], rooms: [87,86,84,85,83] },
        { id: 6, coords: [705,1624,215,1587], rooms: [82,81,80,79,78,77] },
        { id: 7, coords: [673,1412,705,1646], rooms: [76,75,74] },
        { id: 8, coords: [269,555,303,675], rooms: [2,3] },
        { id: 9, coords: [396,615,311,580], rooms: [1,4] },
        { id: 10, coords: [2260,120,2271,432], rooms: [41,42,43,44,45,46,47,48,49,50] }
    ],
    points: [
        [340,537],[224,539],[224,604],[348,657],[1369,542],[1131,649],[1331,650],[1478,544],[1410,664],[1620,650],[1693,544],[1699,664],[1807,542],[1796,665],[1887,544],[1891,662],
        [1975,537],[1994,670],[2142,539],[2291,532],[2289,597],[2283,657],[2156,659],[2138,750],[2128,823],[2279,770],[2151,965],[2279,950],[2143,1063],[2299,1051],[2140,1152],
        [2298,1154],[2140,1300],[2279,1295],[2133,1387],[2283,1380],[2151,1535],[2288,1535],[2143,1616],[2294,1619],[2308,404],[2309,360],[2225,364],[2220,321],[2304,316],[2225,268],
        [2299,265],[2221,200],[2304,207],[2311,142],[987,604],[481,915],[476,1051],[569,916],[561,1043],[649,1048],[744,908],[744,1038],[832,913],[943,916],[937,1016],[1075,906],
        [1075,1054],[1080,1169],[947,1149],[943,1305],[1081,1307],[928,1385],[1075,1388],[935,1528],[1068,1530],[1073,1614],[915,1601],[762,1461],[629,1460],[623,1540],[621,1673],
        [530,1674],[463,1673],[388,1668],[300,1661],[237,1664],[162,1599],[156,1558],[290,1521],[285,1442],[159,1451]
      ],
      stairs: [
        [275,646],[1161,558],[1611,556],[2059,559],[2248,393],[2251,159],[2188,877],[2188,1222],[2192,1459],[672,945],[1033,971],[1040,1220],[1032,1449],[459,1569]
      ]
    },
    {
      name: "Senior GF",
      image: require("../assets/SeniorGF.jpg"),
      originalWidth: 3052,
      originalHeight: 2209,
      corridors: [
        { id: 1, coords: [389,798,1397,841], rooms: [16,17,18,19,20,21,22,23,24,25,26,27,28,29,30] },
        { id: 2, coords: [1404,797,1963,843], rooms: [32,39,34,31,36,35] },
        { id: 3, coords: [1967,798,2772,844], rooms: [37,38,39,40,41,42,43,44,45,46,47,48,49] },
        { id: 4, coords: [1250,1116,1299,1990], rooms: [67,70,72,68,71,73,75,74,77,76,79,78,80,81] },
        { id: 5, coords: [582,1205,1315,1258], rooms: [66,65,69,64,63,62,61,60] },
        { id: 6, coords: [327,1652,376,1957], rooms: [97,98,96,95,93,94,92] },
        { id: 7, coords: [870,1956,317,1913], rooms: [91,90,89,87,88,86] },
        { id: 8, coords: [870,1712,923,1968], rooms: [85,84] },
        { id: 9, coords: [2738,1977,2693,1092], rooms: [13,14,11,12,9,10,7,8,6,5,4,3,2,1] },
        { id: 10, coords: [2732,174,2775,623], rooms: [51,52,53,54,55,56,57,58,59] },
        { id: 11, coords: [392,709,435,800], rooms: [15] }
    ],
    points: [
        [2803,1953],[2795,1853],[2631,1931],[2635,1839],[2834,1694],[2639,1685],[2633,1585],[2795,1610],[2639,1444],[2799,1432],[2623,1334],[2799,1321],[2637,1219],[2811,1209],
        [333,749],[333,847],[496,753],[503,898],[619,747],[725,900],[717,734],[848,749],[940,757],[934,908],[1061,753],[1055,898],[1159,745],[1159,904],[1349,743],[1325,892],
        [1533,892],[1687,763],[1805,769],[1920,755],[1781,904],[1666,890],[2095,757],[2091,904],[2214,739],[2198,892],[2327,755],[2318,908],[2455,749],[2445,896],[2631,749],
        [2648,892],[2819,732],[2803,908],[2819,814],[2823,591],[2693,518],[2697,452],[2823,471],[2703,385],[2828,389],[2815,297],[2830,219],[2689,303],[2815,528],[629,1170],
        [629,1307],[736,1164],[744,1326],[869,1317],[946,1317],[1059,1158],[1183,1170],[1359,1338],[957,1160],[1355,1172],[1192,1444],[1198,1334],[1349,1456],[1363,1595],[1190,1604],
        [1355,1681],[1200,1692],[1368,1853],[1196,1845],[1188,1947],[1355,1941],[985,1618],[975,1749],[807,1773],[807,1851],[807,2013],[705,2013],[701,1853],[543,2009],[458,2021],
        [349,2019],[243,1988],[276,1869],[427,1874],[439,1747],[263,1775],[259,1673],[433,1671]
      ],
      stairs: [
        [400,840],[1421,789],[1993,791],[2533,791],[2717,558],[2729,237],[2697,1137],[2695,1515],[2689,1765],[871,1211],[1294,1233],[1302,1510],[1300,1755],[625,1906]
      ]
    },
  ];
  
  export const adjustRoomsToCorridors = (mapsArray: typeof maps) => {
    return mapsArray.map((map) => {
      if (map.name === "Senior FF") {
        return {
          ...map,
          points: map.points.map((point, index) => {
            if (index === 50 || index === 1 || index === 2 || index === 3 || index === 4) { // room 50 (index 49)
              return point; // Do not adjust this room
            }
            let corridor = map.corridors.find((c) => c.rooms.includes(index + 1));
            return corridor ? adjustClassToCorridor(point, corridor.coords) : point;
          }),
        };
      }
      // For all other maps, proceed normally
      return {
        ...map,
        points: map.points.map((point, index) => {
          let corridor = map.corridors.find((c) => c.rooms.includes(index + 1));
          return corridor ? adjustClassToCorridor(point, corridor.coords) : point;
        }),
      };
    });
  };
  
  export const assignStairsToCorridors = (mapsArray: typeof maps) => {
    return mapsArray.map((map) => {
      const updatedCorridors = map.corridors.map((corridor) => ({
        ...corridor,
        stairs: [] as { index: number; coords: [number, number] }[],
      }));
  
      map.stairs.forEach((stairCoords, stairIndex) => {
        let bestCorridorIndex = -1;
        let bestDistance = Infinity;
        updatedCorridors.forEach((corridor, idx) => {
          const [x1, y1, x2, y2] = corridor.coords;
          if (
            stairCoords[0] >= x1 &&
            stairCoords[0] <= x2 &&
            stairCoords[1] >= y1 &&
            stairCoords[1] <= y2
          ) {
            bestCorridorIndex = idx;
            bestDistance = 0;
          } else {
            const dx = stairCoords[0] < x1 ? x1 - stairCoords[0] : stairCoords[0] > x2 ? stairCoords[0] - x2 : 0;
            const dy = stairCoords[1] < y1 ? y1 - stairCoords[1] : stairCoords[1] > y2 ? stairCoords[1] - y2 : 0;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < bestDistance) {
              bestDistance = dist;
              bestCorridorIndex = idx;
            }
          }
        });
        if (bestCorridorIndex !== -1) {
          updatedCorridors[bestCorridorIndex].stairs.push({ index: stairIndex + 1, coords: stairCoords });
        }
      });
      return { ...map, corridors: updatedCorridors };
    });
  };
  
  export const adjustedMaps = assignStairsToCorridors(adjustRoomsToCorridors(maps));
  console.log(adjustedMaps);
  console.log(maps);
  